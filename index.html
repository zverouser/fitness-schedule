<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: var(--tg-theme-bg-color, #f5f5f5);
            color: var(--tg-theme-text-color, #000000);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        
        #loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            padding: 20px;
            color: var(--tg-theme-hint-color, #999999);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            margin-bottom: 16px;
            border: 3px solid var(--tg-theme-secondary-bg-color, #e0e0e0);
            border-top: 3px solid var(--tg-theme-button-color, #40a7e3);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #widget-container {
            padding: 16px;
            min-height: 100vh;
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ –ø–æ–¥ —Ç–µ–º—É Telegram */
        [data-fit1c-schedule] {
            --primary-color: var(--tg-theme-button-color, #40a7e3);
            --text-color: var(--tg-theme-text-color, #000000);
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }
        
        .error-message {
            color: var(--tg-theme-destructive-text-color, #ff3b30);
            padding: 20px;
            text-align: center;
        }
        
        .retry-btn {
            background-color: var(--tg-theme-button-color, #40a7e3);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading">
        <div class="spinner"></div>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
    <div id="widget-container" style="display: none;"></div>

    <script>
        const WebApp = window.Telegram.WebApp;
        WebApp.ready();
        WebApp.expand();
        
        const loading = document.getElementById('loading');
        const container = document.getElementById('widget-container');
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–∂–µ—Ç–∞
        function loadWidget() {
            // –°–æ–∑–¥–∞–µ–º div –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞
            const widgetDiv = document.createElement('div');
            widgetDiv.setAttribute('data-fit1c-schedule', '');
            container.appendChild(widgetDiv);
            
            // –°–æ–∑–¥–∞–µ–º –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç
            const script = document.createElement('script');
            script.src = 'https://reservi.ru/widget-fit1c.v4/public/init.js';
            script.setAttribute('data-fit-apikey', 'b137fb54-9705-4a88-8738-f1422ad91289');
            script.setAttribute('data-type', 'schedule');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–µ–º—É –ø–æ–¥ Telegram
            const isDark = WebApp.colorScheme === 'dark';
            script.setAttribute('data-theme', isDark ? 'dark' : 'light');
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ (–≤–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
            script.setAttribute('data-settings', JSON.stringify({
                url_data: {
                    page: "schedule",
                    type: "rent",
                    club_id: "f1c7788a-557e-11f0-910a-00505683cb0f",
                    show_type: "day",
                    rent_default_view: "services"
                },
                router: {
                    off: true
                },
                schedule: {
                    blocks_show: {
                        navigation: true
                    },
                    filter: {
                        services_avail: [
                            "c405e0d0-d0fd-11f0-997d-00505683cb0f",
                            "7d931ae0-d0fe-11f0-9b19-00505683cb0f"
                        ]
                    }
                }
            }));
            
            // –ö–æ–≥–¥–∞ —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
            script.onload = function() {
                console.log('–í–∏–¥–∂–µ—Ç v4 –∑–∞–≥—Ä—É–∂–µ–Ω, –æ–∂–∏–¥–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                let attempts = 0;
                const checkInterval = setInterval(function() {
                    attempts++;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—è–≤–∏–ª—Å—è –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –≤–∏–¥–∂–µ—Ç–µ
                    if (widgetDiv.children.length > 0) {
                        clearInterval(checkInterval);
                        loading.style.display = 'none';
                        container.style.display = 'block';
                        console.log('–í–∏–¥–∂–µ—Ç —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                        if (WebApp.initDataUnsafe?.user?.first_name) {
                            WebApp.showPopup({
                                title: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å',
                                message: `–ü—Ä–∏–≤–µ—Ç, ${WebApp.initDataUnsafe.user.first_name}!`,
                                buttons: [{type: 'ok'}]
                            });
                        }
                    }
                    
                    if (attempts > 20) { // 10 —Å–µ–∫—É–Ω–¥ –º–∞–∫—Å–∏–º—É–º
                        clearInterval(checkInterval);
                        if (widgetDiv.children.length === 0) {
                            showError();
                        }
                    }
                }, 500);
            };
            
            script.onerror = function() {
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–∂–µ—Ç');
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.head.appendChild(script);
        }
        
        function showError(message) {
            loading.innerHTML = `
                <div class="error-message">
                    ‚ùå ${message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è'}<br><br>
                    <button class="retry-btn" onclick="location.reload()">
                        üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            `;
            
            WebApp.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å')
                .onClick(() => WebApp.close())
                .show();
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        loadWidget();
        
        // –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ç–µ–º—ã Telegram
        WebApp.onEvent('themeChanged', function() {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∏–ª —Ç–µ–º—É, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–π —Ç–µ–º—ã –∫ –≤–∏–¥–∂–µ—Ç—É
            location.reload();
        });
        
    </script>
</body>
</html>
