<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        .status {
            text-align: center;
            padding: 20px;
            margin-top: 50px;
        }
        .loading {
            color: var(--tg-theme-hint-color, #999999);
        }
        .error {
            color: var(--tg-theme-destructive-text-color, #ff3b30);
        }
        .retry-btn {
            background-color: var(--tg-theme-button-color, #40a7e3);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="status" class="status loading">
        <div>üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>
    </div>
    
    <!-- –ú–µ—Å—Ç–æ –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ) -->
    <div id="widget-container" style="display: none;"></div>

    <script>
        const WebApp = window.Telegram.WebApp;
        WebApp.ready();
        WebApp.expand();
        
        const statusDiv = document.getElementById('status');
        const container = document.getElementById('widget-container');
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                script.setAttribute('data-fit-salon-id', 'faaa38c4-30d3-4d6d-ac61-08acc927e27a');
                document.head.appendChild(script);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞
        function createWidget() {
            return new Promise((resolve) => {
                // –°–æ–∑–¥–∞–µ–º div —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞
                const widgetDiv = document.createElement('div');
                widgetDiv.setAttribute('data-fit1c-calendar', '');
                widgetDiv.innerHTML = '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ <a href="https://www.fitness1c.ru">1–°:–§–∏—Ç–Ω–µ—Å –∫–ª—É–±</a>';
                
                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤–∏–¥–∂–µ—Ç
                container.innerHTML = '';
                container.appendChild(widgetDiv);
                
                // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ, —á—Ç–æ–±—ã –≤–∏–¥–∂–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è
                setTimeout(() => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—è–≤–∏–ª—Å—è –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç
                    if (widgetDiv.children.length > 1) {
                        resolve(true);
                    } else {
                        resolve(false);
                    }
                }, 3000);
            });
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        async function initWidget() {
            try {
                statusDiv.innerHTML = '<div class="loading">üì° –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç –≤–∏–¥–∂–µ—Ç–∞
                await loadScript('https://reservi.ru/widget-fit1c.v2/js/config.js');
                
                statusDiv.innerHTML = '<div class="loading">üìÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>';
                
                // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–∂–µ—Ç
                const widgetCreated = await createWidget();
                
                if (widgetCreated) {
                    statusDiv.style.display = 'none';
                    container.style.display = 'block';
                    console.log('–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ Telegram
                    if (WebApp.initDataUnsafe?.user?.first_name) {
                        console.log(`–ü—Ä–∏–≤–µ—Ç, ${WebApp.initDataUnsafe.user.first_name}!`);
                    }
                } else {
                    throw new Error('–í–∏–¥–∂–µ—Ç –Ω–µ —Å–æ–∑–¥–∞–ª—Å—è');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                
                statusDiv.innerHTML = `
                    <div class="error">
                        ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ<br><br>
                        <small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</small><br>
                        ‚Ä¢ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É<br>
                        ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç<br>
                        ‚Ä¢ –û—Ç–∫—Ä—ã—Ç—å –≤ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ<br><br>
                        <button class="retry-btn" onclick="location.reload()">
                            üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                        </button>
                    </div>
                `;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è –≤ Telegram
                WebApp.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å').onClick(() => WebApp.close()).show();
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        initWidget();
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤
        window.addEventListener('error', function(e) {
            if (e.target.src && e.target.src.includes('reservi.ru')) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ –≤–∏–¥–∂–µ—Ç–∞');
            }
        });
        
    </script>
</body>
</html>
