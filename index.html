<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        
        #status {
            text-align: center;
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .loading {
            color: var(--tg-theme-hint-color, #999999);
        }
        
        .error {
            color: var(--tg-theme-destructive-text-color, #ff3b30);
        }
        
        .retry-btn {
            background-color: var(--tg-theme-button-color, #40a7e3);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ */
        [data-fit1c-calendar] {
            width: 100%;
            min-height: 600px;
        }
    </style>
</head>
<body>
    <div id="status" class="loading">
        <div>üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>
        <div style="font-size: 14px; margin-top: 10px;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ -->
    <div id="widget-container" style="display: none;"></div>

    <script>
        const WebApp = window.Telegram.WebApp;
        WebApp.ready();
        WebApp.expand();
        
        const statusDiv = document.getElementById('status');
        const container = document.getElementById('widget-container');
        
        // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        function loadWidget() {
            statusDiv.innerHTML = '<div class="loading">üì° –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>';
            
            // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä–∏–ø—Ç
            const script = document.createElement('script');
            script.src = 'https://reservi.ru/widget-fit1c.v2/js/config.js';
            script.setAttribute('data-fit-salon-id', 'faaa38c4-30d3-4d6d-ac61-08acc927e27a');
            
            // –°–æ–∑–¥–∞–µ–º div –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞
            const widgetDiv = document.createElement('div');
            widgetDiv.setAttribute('data-fit1c-calendar', '');
            widgetDiv.innerHTML = '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            container.appendChild(widgetDiv);
            document.head.appendChild(script);
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞
            script.onload = function() {
                console.log('–°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, –∂–¥–µ–º –≤–∏–¥–∂–µ—Ç...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—è–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                let attempts = 0;
                const checkInterval = setInterval(function() {
                    attempts++;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∏–¥–∂–µ—Ç–∞
                    // (–≤–∏–¥–∂–µ—Ç —Å–∞–º –∑–∞–º–µ–Ω—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)
                    const currentContent = widgetDiv.innerHTML;
                    
                    // –ï—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–µ "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è..." –∏ –Ω–µ –ø—É—Å—Ç–æ–µ
                    if (currentContent !== '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...' && currentContent.length > 0) {
                        clearInterval(checkInterval);
                        console.log('–í–∏–¥–∂–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω!');
                        statusDiv.style.display = 'none';
                        container.style.display = 'block';
                    }
                    
                    // –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ 10 —Å–µ–∫—É–Ω–¥ - —Å—á–∏—Ç–∞–µ–º —á—Ç–æ –≤–∏–¥–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
                    if (attempts > 10) {
                        clearInterval(checkInterval);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∏–¥–∂–µ—Ç —É–∂–µ –µ—Å—Ç—å –≤ DOM
                        const calendarElements = document.querySelectorAll('[data-fit1c-calendar]');
                        if (calendarElements.length > 0 && calendarElements[0].children.length > 0) {
                            statusDiv.style.display = 'none';
                            container.style.display = 'block';
                        } else {
                            showError();
                        }
                    }
                }, 1000);
            };
            
            script.onerror = function() {
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è');
            };
        }
        
        function showError(message) {
            statusDiv.innerHTML = `
                <div class="error">
                    ‚ùå ${message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ'}<br><br>
                    <small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞</small><br><br>
                    <button class="retry-btn" onclick="location.reload()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            `;
            
            WebApp.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å').onClick(() => WebApp.close()).show();
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        loadWidget();
        
    </script>
</body>
</html>
