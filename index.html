<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        
        #status {
            text-align: center;
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .loading {
            color: var(--tg-theme-hint-color, #999999);
        }
        
        .error {
            color: var(--tg-theme-destructive-text-color, #ff3b30);
        }
        
        .retry-btn {
            background-color: var(--tg-theme-button-color, #40a7e3);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤–∏–¥–∂–µ—Ç–∞ */
        #widget-container {
            width: 100%;
            min-height: 100vh;
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ –ø–æ–¥ Telegram */
        [data-fit1c-schedule] {
            --primary-color: var(--tg-theme-button-color, #40a7e3);
            --text-color: var(--tg-theme-text-color, #000000);
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f0f0f0);
        }
        
        body.dark-theme {
            /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –µ—Å–ª–∏ –Ω—É–∂–Ω—ã */
        }
    </style>
</head>
<body>
    <div id="status" class="loading">
        <div>üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>
        <div style="font-size: 14px; margin-top: 10px;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ω–æ–≤–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ v4 -->
    <div id="widget-container" style="display: none;"></div>

    <script>
        const WebApp = window.Telegram.WebApp;
        WebApp.ready();
        WebApp.expand();
        
        // === –ü–û–î–î–ï–†–ñ–ö–ê –¢–ï–ú TELEGRAM ===
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
        if (WebApp.colorScheme === 'dark') {
            document.body.classList.add('dark-theme');
        }
        
        // –ü—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
        WebApp.onEvent('themeChanged', function() {
            location.reload();
        });
        // === –ö–û–ù–ï–¶ –ü–û–î–î–ï–†–ñ–ö–ò –¢–ï–ú ===
        
        const statusDiv = document.getElementById('status');
        const container = document.getElementById('widget-container');
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ v4
        function loadWidget() {
            statusDiv.innerHTML = '<div class="loading">üì° –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</div>';
            
            // –°–æ–∑–¥–∞–µ–º div –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ (–Ω–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç data-fit1c-schedule)
            const widgetDiv = document.createElement('div');
            widgetDiv.setAttribute('data-fit1c-schedule', '');
            container.appendChild(widgetDiv);
            
            // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ v4
            const script = document.createElement('script');
            script.src = 'https://reservi.ru/widget-fit1c.v4/public/init.js';
            script.setAttribute('data-fit-apikey', 'b137fb54-9705-4a88-8738-f1422ad91289');
            script.setAttribute('data-type', 'schedule');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–º—É Telegram
            const currentTheme = WebApp.colorScheme === 'dark' ? 'dark' : 'light';
            script.setAttribute('data-theme', currentTheme);
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ (–≤–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
            script.setAttribute('data-settings', JSON.stringify({
                url_data: {
                    page: "schedule",
                    type: "rent",
                    club_id: "f1c7788a-557e-11f0-910a-00505683cb0f",
                    show_type: "day",
                    rent_default_view: "services"
                },
                router: {
                    off: true
                },
                schedule: {
                    blocks_show: {
                        navigation: true
                    },
                    filter: {
                        services_avail: [
                            "c405e0d0-d0fd-11f0-997d-00505683cb0f",
                            "7d931ae0-d0fe-11f0-9b19-00505683cb0f"
                        ]
                    }
                }
            }));
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.head.appendChild(script);
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞
            script.onload = function() {
                console.log('–°–∫—Ä–∏–ø—Ç v4 –∑–∞–≥—Ä—É–∂–µ–Ω, –∂–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                let attempts = 0;
                const checkInterval = setInterval(function() {
                    attempts++;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—è–≤–∏–ª—Å—è –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –≤–∏–¥–∂–µ—Ç–µ
                    if (widgetDiv.children.length > 0) {
                        clearInterval(checkInterval);
                        console.log('–í–∏–¥–∂–µ—Ç v4 —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                        statusDiv.style.display = 'none';
                        container.style.display = 'block';
                    }
                    
                    // –¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥
                    if (attempts > 20) {
                        clearInterval(checkInterval);
                        if (widgetDiv.children.length === 0) {
                            showError('–í–∏–¥–∂–µ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è');
                        }
                    }
                }, 500);
            };
            
            script.onerror = function() {
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –≤–∏–¥–∂–µ—Ç–∞');
            };
        }
        
        function showError(message) {
            statusDiv.innerHTML = `
                <div class="error">
                    ‚ùå ${message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ'}<br><br>
                    <small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞</small><br><br>
                    <button class="retry-btn" onclick="location.reload()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            `;
            
            WebApp.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å').onClick(() => WebApp.close()).show();
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        loadWidget();
        
    </script>
</body>
</html>
